{% load crispy_forms_tags %}

<!-- Password Reset Confirm -->
<div class="container p-5">
  <div class="row justify-content-center">
    <div class="col-md-6">
      <div class="password-reset-confirm-card">
        <h2 class="font-weight-bold mt-3 mb-4">Confirmation de mot de passe</h2>
        <hr class="my-4" />
        <p class="mb-4">Veuillez créer un nouveau mot de passe.</p>
        <!-- <form method="POST">
          {% csrf_token %} {{ password_reset_confirm|crispy }}

          <div class="form-group">
            <button class="btn btn-primary btn-block" type="submit">
              Reset Password
            </button>
          </div>
        </form> -->
        <form method="POST">
          {% csrf_token %}
     
          <div class="form-group">
            <label for="id_new_password1">Nouveau mot de passe</label>
            <input
              type="password"
              name="new_password1"
              id="id_new_password1"
              class="form-control"
            />
          </div>
          <div class="form-group">
            <label for="id_new_password2">Repéter mot de passe </label>
            <input
              type="password"
              name="new_password2"
              id="id_new_password2"
              class="form-control"
            />
          </div>
          <div id="password-error-messages" class="text-danger"></div>
          <button class="btn btn-primary btn-block" type="submit">
            Confirmer
          </button>
        </form>

        <script>
          document.addEventListener("DOMContentLoaded", function () {
            const passwordInput = document.getElementById("id_new_password1");
            const password2Input = document.getElementById("id_new_password2");
            const passwordErrorMessages = document.getElementById(
              "password-error-messages"
            );
            const button = document.querySelector('button[type="submit"]'); // Cible le bouton de soumission du formulaire

            function validatePassword() {
              const password = passwordInput.value;
              const password2 = password2Input.value;

              let errors = [];

              // Vérifications des règles de validation du mot de passe
              if (password.length < 8) {
                errors.push(
                  "Votre mot de passe doit contenir au moins 8 caractères."
                );
              }
              if (!/[a-zA-Z]/.test(password)) {
                errors.push("Votre mot de passe doit contenir des lettres.");
              }
              if (!/\d/.test(password)) {
                errors.push("Votre mot de passe doit contenir des chiffres.");
              }
              if (/^[a-zA-Z0-9]+$/.test(password)) {
                errors.push(
                  "Le mot de passe doit contenir au moins un caractère spécial (@, !)"
                );
              }

              // Vérification de la correspondance des mots de passe
              if (password !== password2) {
                errors.push("Les mots de passe ne correspondent pas !");
              } else {
                button.disabled = false;
              }

              // Affichage des messages d'erreur
              passwordErrorMessages.innerHTML = errors
                .map((error) => `<p>${error}</p>`)
                .join("");

              // Activation/Désactivation du bouton de soumission
              button.disabled = errors.length > 0;
            }

            // Écouteur d'événement pour le premier champ de mot de passe
            passwordInput.addEventListener("input", validatePassword);

            // Écouteur d'événement pour le champ de confirmation du mot de passe
            password2Input.addEventListener("input", validatePassword);
          });
        </script>
      </div>
    </div>
  </div>
  <div class="text-center">
        <a class="btn btn-primary" href="{% url 'home' %}"
          >Retour à l'acceuil</a
        >
      </div>
</div>
<style>
    .btn-primary {
    background-color: #007bff;
    color: #ffffff;
    padding: 12px 25px;
    border-radius: 5px;
    text-decoration: none;
    transition: background-color 0.3s ease;
  }

  .btn-primary:hover {
    background-color: #0056b3;
  }
  body {
    font-family: Arial, sans-serif;
    background-color: #7a6ad8;
    padding: 20px;
  }
  .password-reset-confirm-card {
    background-color: #ffffff;
    border-radius: 10px;
    box-shadow: 0px 0px 15px rgba(0, 0, 0, 0.1);
    padding: 40px;
    margin-right: 35%;
    margin-left: 35%;
    margin-top: 1.5rem;
  }

  .font-weight-bold {
    color: #333;
    font-size: 24px;
  }

  hr {
    border-color: #ccc;
  }

  .p-5 {
    padding: 3rem !important;
  }

  .mb-4 {
    margin-bottom: 1.5rem !important;
  }
  .text-danger {
    font-weight: bold;
    color: rgba(255, 0, 0, 0.428);
  }

  .form-group {
    margin-bottom: 0.8rem;
    display: flex;
    justify-content: center;
    justify-self: start;
    align-items: flex-start;
  }

  .btn-primary {
    background-color: #7a6ad8;
    border-color: #7b6ad8da;
    border-radius: 10rem;
    padding: 0.5em;
    display: flex;
    float: right;
  }

  .btn-primary:hover {
    background-color: #ffff;
    border-color: #7b6ad8da;
  }
  .form-control {
    border-radius: 0.5rem;
    max-height: 3rem;
    margin-bottom: 1rem;
  }
</style>
